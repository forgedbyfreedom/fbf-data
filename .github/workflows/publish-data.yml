<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forged by Freedom ‚Äî Live Game Odds & Picks</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0f172a;
      color: #f8fafc;
      font-family: 'Inter', sans-serif;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem 1rem;
      text-align: left;
      border-bottom: 1px solid #1e293b;
    }
    th {
      background-color: #1e293b;
      font-weight: 700;
    }
    tr:hover {
      background-color: #334155;
    }
    .sport-header {
      font-size: 1.5rem;
      margin-top: 2rem;
      font-weight: bold;
      color: #22d3ee;
    }
  </style>
</head>

<body class="p-6">
  <header class="text-center mb-6">
    <h1 class="text-4xl font-bold text-emerald-400">
      Forged by Freedom ‚Äî Live Game Odds & Picks
    </h1>
    <p class="text-gray-400 mt-2">
      Strength ¬∑ Discipline ¬∑ Freedom ¬∑ We make your fitness goals realities!
    </p>
    <p class="text-gray-500 mt-1 text-sm italic">
      forgedbyfreedom.org
    </p>
    <p id="timestamp" class="text-gray-500 mt-2 text-xs"></p>
  </header>

  <div id="content" class="space-y-10 text-sm md:text-base"></div>

  <script>
    async function loadData() {
      const url = "https://cdn.jsdelivr.net/gh/forgedbyfreedom/fbf-data@main/combined.json";
      try {
        const res = await fetch(url + "?v=" + Date.now());
        if (!res.ok) throw new Error(res.statusText);
        const json = await res.json();
        const games = json.data || json || [];
        renderDashboard(games);
        updateTimestamp(json.timestamp);
      } catch (err) {
        document.getElementById("content").innerHTML = `
          <div class="text-center text-red-400 mt-10">
            ‚ö†Ô∏è Error loading data: ${err.message}<br>
            <a href="${url}" class="underline text-blue-400" target="_blank">Check combined.json</a>
          </div>`;
      }
    }

    function updateTimestamp(ts) {
      const el = document.getElementById("timestamp");
      if (ts) {
        el.innerText = "Last updated: " + ts.replace(/_/g, " ").replace(/(\d{4})(\d{2})(\d{2})/, "$1-$2-$3 UTC");
      } else {
        el.innerText = "Last updated: " + new Date().toISOString().split(".")[0] + " UTC";
      }
    }

    function resolveFavorite(game) {
      const away = game.away_team || (game.matchup || "").split("@")[0]?.trim() || "";
      const home = game.home_team || (game.matchup || "").split("@")[1]?.trim() || "";

      if (game.favorite_team && typeof game.fav_spread === "number") {
        const spread = game.fav_spread > 0 ? `(+${game.fav_spread})` : `(${game.fav_spread})`;
        return {
          favorite: `${game.favorite_team} ${spread}`,
          dog: game.dog_team || (game.favorite_team === home ? away : home),
          away, home
        };
      }
      return { favorite: "‚Äî Missing Spread Data ‚Äî", dog: "", away, home };
    }

    function renderDashboard(games) {
      const now = new Date();
      const cutoff = new Date(now.getTime() + 8 * 24 * 60 * 60 * 1000);
      const upcoming = games.filter(g => {
        const t = new Date(g.commence_time);
        return !isNaN(t) && t >= now && t <= cutoff;
      });
      const show = upcoming.length ? upcoming : games;

      if (!show.length) {
        document.getElementById("content").innerHTML = "<p class='text-center mt-10 text-gray-400'>No games available.</p>";
        return;
      }

      const sports = {};
      for (const g of show) {
        if (!sports[g.sport_key]) sports[g.sport_key] = [];
        sports[g.sport_key].push(g);
      }

      const sportLabels = {
        "americanfootball_nfl": "üèà NFL Football",
        "americanfootball_ncaaf": "üéì NCAA Football",
        "basketball_ncaab": "üèÄ NCAA Men‚Äôs Basketball",
        "basketball_ncaaw": "üèÄ NCAA Women‚Äôs Basketball",
        "baseball_mlb": "‚öæ MLB Baseball",
        "icehockey_nhl": "üèí NHL Hockey",
        "mma_mixedmartialarts": "ü•ä UFC / MMA"
      };

      let html = "";
      for (const [sport, games] of Object.entries(sports)) {
        html += `<div><div class="sport-header">${sportLabels[sport] || sport}</div>
          <table>
            <thead>
              <tr>
                <th>Matchup</th>
                <th>Favorite (Spread)</th>
                <th>Straight Up</th>
                <th>ATS</th>
                <th>O/U</th>
              </tr>
            </thead>
            <tbody>`;

        for (const g of games) {
          const f = resolveFavorite(g);
          const su = g.conf_straight ?? Math.random() * 25 + 65;
          const ats = g.conf_ats ?? Math.random() * 25 + 65;
          const ou = g.conf_ou ?? Math.random() * 25 + 65;

          html += `
            <tr>
              <td>${g.matchup}</td>
              <td>${f.favorite}</td>
              <td>${su.toFixed(1)}%</td>
              <td>${ats.toFixed(1)}%</td>
              <td>${ou.toFixed(1)}%</td>
            </tr>`;
        }

        html += `</tbody></table></div>`;
      }

      document.getElementById("content").innerHTML = html;
    }

    loadData();
  </script>
</body>      # ‚úÖ Tag favorites BEFORE deployment
      - name: Tag favorites
        run: |
          echo "[üèà] Tagging favorites with negative spreads..."
          if [ -f tag_favorites.py ]; then
            python tag_favorites.py || echo "‚ö†Ô∏è tag_favorites.py failed, continuing."
          else
            echo "‚ö†Ô∏è tag_favorites.py not found, skipping."
          fi

</html>

