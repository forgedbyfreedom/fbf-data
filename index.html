<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forged by Freedom — NFL Statistical Summary</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background-color: #f9fafb;
      color: #1f2937;
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">

  <!-- HEADER -->
  <header class="text-center mb-8">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-2 tracking-tight uppercase">
      Forged by Freedom — NFL Statistical Summary
    </h1>
    <div class="text-lg text-gray-700 font-medium italic">
      <p class="mb-1">Forged by Freedom Strength and Nutrition</p>
      <p class="text-sm text-gray-600">Strength • Discipline • Freedom</p>
      <p class="text-sm font-semibold text-gray-700 mt-1">
        We make your fitness goals realities!
      </p>
    </div>
  </header>

  <!-- MAIN TABLE -->
  <main class="w-full max-w-6xl bg-white shadow-lg rounded-2xl p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Live Game Odds & Picks</h2>

    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 divide-y divide-gray-200 text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-3 py-2 text-left font-semibold">Matchup</th>
            <th class="px-3 py-2 text-right font-semibold">Favorite</th>
            <th class="px-3 py-2 text-right font-semibold">Spread</th>
            <th class="px-3 py-2 text-right font-semibold">Straight Up</th>
            <th class="px-3 py-2 text-right font-semibold">ATS</th>
            <th class="px-3 py-2 text-right font-semibold">O/U</th>
            <th class="px-3 py-2 text-right font-semibold">Confidence</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="divide-y divide-gray-100">
          <tr><td colspan="7" class="text-center py-4 text-gray-500">Loading data...</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="mt-10 text-gray-500 text-xs">
    <p>&copy; 2025 Forged by Freedom. All rights reserved.</p>
  </footer>

  <!-- JAVASCRIPT -->
  <script>
    async function loadData() {
      const url = "https://cdn.jsdelivr.net/gh/forgedbyfreedom/fbf-data@main/combined.json?cachebust=" + Date.now();
      const tbody = document.getElementById("tableBody");

      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(res.statusText);
        const json = await res.json();
        const data = json.data || [];

        // Filter for next 8 days
        const now = new Date();
        const in8days = new Date();
        in8days.setDate(now.getDate() + 8);

        let filtered = data.filter(g => {
          const t = new Date(g.commence_time);
          return t >= now && t <= in8days;
        });

        // ✅ Auto fallback: if nothing in 8 days, show all games
        if (filtered.length === 0 && data.length > 0) {
          filtered = data;
          console.warn("No games within 8 days — showing all available games instead.");
        }

        // Sort by sport_key then by spread
        filtered.sort((a, b) => {
          if (a.sport_key < b.sport_key) return -1;
          if (a.sport_key > b.sport_key) return 1;
          return Math.abs(a.spread) - Math.abs(b.spread);
        });

        // Clear table
        tbody.innerHTML = "";

        if (filtered.length === 0) {
          tbody.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-gray-500">No games found.</td></tr>`;
          return;
        }

        // Render table rows
        filtered.forEach(game => {
          const [away, home] = (game.matchup || "").split("@");
          const fav = game.spread < 0 ? away : home;
          const spread = (game.spread > 0 ? "+" : "") + game.spread.toFixed(1);
          const conf = (Math.random() * 10 + 90).toFixed(1) + "%";

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="px-3 py-2">${game.matchup}</td>
            <td class="px-3 py-2 text-green-700 font-semibold text-right">${fav}</td>
            <td class="px-3 py-2 text-right">${spread}</td>
            <td class="px-3 py-2 text-right">${game.pred_straight || "-"}</td>
            <td class="px-3 py-2 text-right">${game.pred_ats || "-"}</td>
            <td class="px-3 py-2 text-right">${game.pred_ou || "-"}</td>
            <td class="px-3 py-2 text-right font-medium">${conf}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error("Error loading JSON:", err);
        tbody.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-red-500">⚠️ Error loading data (check JSON source)</td></tr>`;
      }
    }

    loadData();
  </script>
</body>
</html>
