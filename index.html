<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Forged by Freedom ‚Äî Live Betting Dashboard</title>

<!-- Tailwind via CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { background-color: #0f172a; color: #e2e8f0; }
  .badge { padding: .15rem .45rem; border-radius: .5rem; font-weight: 600; }
  .fav { background: rgba(34,197,94,.18); color: #86efac; border: 1px solid #22c55e44; }
  .dog { background: rgba(239,68,68,.18); color: #fca5a5; border: 1px solid #ef444444; }
  .header { font-size: 1.25rem; font-weight: 700; color: #facc15; padding: 1rem 0 .5rem 0; border-bottom: 1px solid #475569; margin-top: 1.5rem; }
</style>
</head>

<body class="min-h-screen flex flex-col items-center justify-start py-8 px-4">
  <h1 class="text-3xl font-bold mb-4 text-center">Forged by Freedom ‚Äî Sports Betting Dashboard</h1>
  <p id="status" class="text-gray-400 text-sm mb-6 text-center">Loading latest data...</p>

  <div id="container" class="w-full max-w-6xl"></div>

  <footer class="text-xs text-gray-500 mt-6 text-center">
    Data auto-fetched from <code>combined.json</code>. Results are informational only.
  </footer>

<script>
async function loadData() {
  const status = document.getElementById("status");
  const container = document.getElementById("container");

  try {
    status.textContent = "Fetching data via proxy...";

    // ‚úÖ CORS-safe proxy pulling from your raw GitHub data
    const proxyURL =
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent("https://raw.githubusercontent.com/forgedbyfreedom/fbf-data/main/combined.json");

    const res = await fetch(proxyURL, { cache: "no-cache" });
    if (!res.ok) throw new Error("Fetch failed: " + res.status);
    const json = await res.json();
    const data = json.data ?? json;

    if (!Array.isArray(data)) throw new Error("Data format invalid");

    // üèà Sort by category (Football first)
    const sportOrder = [
      "americanfootball_nfl",
      "americanfootball_ncaaf",
      "basketball_ncaab",
      "basketball_ncaaw",
      "baseball_mlb",
      "icehockey_nhl",
      "mma_mixedmartialarts"
    ];

    const grouped = {};
    data.forEach(row => {
      const sport = row.sport_key || "other";
      if (!grouped[sport]) grouped[sport] = [];
      grouped[sport].push(row);
    });

    // Clear container
    container.innerHTML = "";

    // Render sections by sport order
    sportOrder.forEach(sport => {
      const games = grouped[sport];
      if (!games || games.length === 0) return;

      // Section title
      const sportNameMap = {
        americanfootball_nfl: "NFL Football",
        americanfootball_ncaaf: "NCAA Football",
        basketball_ncaab: "NCAA Men‚Äôs Basketball",
        basketball_ncaaw: "NCAA Women‚Äôs Basketball",
        baseball_mlb: "MLB Baseball",
        icehockey_nhl: "NHL Hockey",
        mma_mixedmartialarts: "UFC / MMA"
      };
      const section = document.createElement("div");
      section.innerHTML = `<div class="header">${sportNameMap[sport] || sport}</div>
        <div class="overflow-x-auto shadow-lg rounded-lg mb-6">
          <table class="min-w-full border border-gray-700 text-sm">
            <thead class="bg-gray-800 text-gray-200">
              <tr>
                <th class="px-3 py-2 text-left">Matchup</th>
                <th class="px-3 py-2 text-left">Favorite</th>
                <th class="px-3 py-2 text-left">Underdog</th>
                <th class="px-3 py-2 text-right">Spread</th>
                <th class="px-3 py-2 text-right">Total</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-700 bg-gray-900"></tbody>
          </table>
        </div>`;
      container.appendChild(section);

      const tbody = section.querySelector("tbody");

      // Sort by time
      games.sort((a, b) => new Date(a.commence_time) - new Date(b.commence_time));

      games.forEach(row => {
        const [teamA, teamB] = row.matchup.split("@").map(s => s.trim());
        const fav = row.ml_fav < row.ml_dog ? teamA : teamB;
        const dog = row.ml_fav < row.ml_dog ? teamB : teamA;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="px-3 py-2 text-left">${teamA} @ ${teamB}</td>
          <td class="px-3 py-2"><span class="badge fav">${fav}</span></td>
          <td class="px-3 py-2"><span class="badge dog">${dog}</span></td>
          <td class="px-3 py-2 text-right">${row.spread ?? ""}</td>
          <td class="px-3 py-2 text-right">${row.total ?? ""}</td>`;
        tbody.appendChild(tr);
      });
    });

    status.textContent = "‚úÖ Data loaded successfully.";
  } catch (err) {
    console.error("Error loading data:", err);
    status.textContent = "‚ö†Ô∏è Failed to load: " + err.message;
  }
}

window.onload = loadData;
</script>
</body>
</html>
