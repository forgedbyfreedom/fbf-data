<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Forged by Freedom — NFL SU / ATS / O/U (10k Sims)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .badge { padding: .15rem .45rem; border-radius: .5rem; font-weight: 600; }
  .fav { background: rgba(34,197,94,.18); color: #86efac; border: 1px solid #22c55e44; }
  .dog { background: rgba(239,68,68,.18); color: #fca5a5; border: 1px solid #ef444444; }
  .lean { background: rgba(59,130,246,.18); color:#93c5fd; border:1px solid #3b82f644; }
</style>

<script>
/* =============================== */
/* CONFIG                          */
/* =============================== */
const N_SIM = 10000;            // Monte Carlo sims per matchup
const TEAM_SD_POINTS = 13;      // Points standard deviation per team
const DATA_PATH = "./combined.json"; // same directory as index.html

/* ===== RNG: Normal(mean, sd) ===== */
function randn_bm() {
  let u = 0, v = 0;
  while (u === 0) u = Math.random();
  while (v === 0) v = Math.random();
  return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}
function rnorm(mean, sd) {
  return mean + randn_bm() * sd;
}

/* ===== Simulate one matchup ===== */
function simulateMatchup(total, spread, nSim = N_SIM, sd = TEAM_SD_POINTS) {
  const favMean = (total / 2) + (spread / 2);
  const dogMean = (total / 2) - (spread / 2);

  let favSU = 0, dogSU = 0;
  let favATS = 0, dogATS = 0, atsPush = 0;
  let over = 0, under = 0;

  for (let i = 0; i < nSim; i++) {
    const favScore = rnorm(favMean, sd);
    const dogScore = rnorm(dogMean, sd);

    // SU
    if (favScore > dogScore) favSU++; else dogSU++;

    // ATS (favorite - spread)
    const margin = favScore - dogScore;
    if (margin > -spread) favATS++;
    else if (margin < -spread) dogATS++;
    else atsPush++;

    // Total
    const totPts = favScore + dogScore;
    if (totPts > total) over++;
    else if (totPts < total) under++;
  }

  const suTotal = favSU + dogSU;
  const atsTotal = favATS + dogATS;
  const totTotal = over + under;

  return {
    favSU: (favSU / suTotal) * 100,
    dogSU: (dogSU / suTotal) * 100,
    favATS: (favATS / atsTotal) * 100,
    dogATS: (dogATS / atsTotal) * 100,
    over: (over / totTotal) * 100,
    under: (under / totTotal) * 100,
  };
}

/* ===== Load JSON and Simulate All Games ===== */
async function loadData() {
  try {
    document.getElementById("status").textContent = "Running 10k simulations per game…";
    const res = await fetch(DATA_PATH, { cache: "no-cache" });
    if (!res.ok) throw new Error("HTTP " + res.status);

    const json = await res.json();
    const data = json.data.filter(d => d.sport_key && d.sport_key.includes("nfl"));

    const games = data.map(row
