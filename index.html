<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forged by Freedom â€” Live Game Odds & Picks</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      background: #141a22;
      padding: 1rem;
      border-bottom: 2px solid #feca1b;
    }
    header img {
      height: 60px;
      width: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 10px;
    }
    h1 {
      font-size: 1.8rem;
      color: #feca1b;
      margin: 0;
      text-align: center;
    }
    h3 {
      color: #00c6ff;
      margin: 5px 0;
      text-align: center;
    }
    h3 a {
      color: #00c6ff;
      text-decoration: none;
    }
    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 1rem auto;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
    }
    .color-box {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }
    .day-section {
      margin: 2rem auto;
      width: 92%;
      border-top: 2px solid #feca1b;
      padding-top: 1rem;
    }
    .sport-header {
      text-align: left;
      color: #feca1b;
      font-size: 1.3rem;
      border-bottom: 1px solid #444;
      padding-bottom: 0.3rem;
      margin-top: 1rem;
    }
    table {
      width: 100%;
      margin: 1rem auto;
      border-collapse: collapse;
      background: #18222d;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #333;
      text-align: center;
    }
    th {
      background: #243447;
      color: #feca1b;
    }
    tr:nth-child(even) {
      background: #1c2833;
    }
    #performance {
      background: #141a22;
      border: 1px solid #333;
      margin: 20px auto;
      width: 80%;
      border-radius: 10px;
      padding: 10px;
      color: #feca1b;
      text-align: center;
    }
    footer {
      margin: 2rem 0;
      color: #aaa;
      font-size: 0.9rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Forged by Freedom Logo" />
    <div>
      <h1>Forged by Freedom â€” Live Game Odds & Picks</h1>
      <h3>Strength Â· Discipline Â· Freedom Â· We make your fitness goals realities!</h3>
      <h3><a href="https://forgedbyfreedom.org">ForgedByFreedom.org</a></h3>
    </div>
  </header>

  <div class="legend">
    <div class="legend-item"><div class="color-box" style="background:#4CAF50"></div> High Confidence (85â€“100%)</div>
    <div class="legend-item"><div class="color-box" style="background:#FFC107"></div> Moderate (65â€“84%)</div>
    <div class="legend-item"><div class="color-box" style="background:#FF5722"></div> Low (<65%)</div>
  </div>

  <div id="performance">Loading weekly performance...</div>

  <div id="oddsContainer">
    <p style="text-align:center;">Loading games...</p>
  </div>

  <footer>
    Updated automatically every 30 minutes Â· Powered by Forged by Freedom Data
  </footer>

  <script>
    function confidenceColor(conf) {
      if (conf >= 85) return '#4CAF50';
      if (conf >= 65) return '#FFC107';
      return '#FF5722';
    }

    function normalize(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    async function loadData() {
      try {
        const [resOdds, resPerf] = await Promise.all([
          fetch('combined.json'),
          fetch('performance_log.json')
        ]);
        const data = await resOdds.json();
        const perf = await resPerf.json();
        const recent = perf.length ? perf[perf.length - 1] : {SU_accuracy: 65, ATS_accuracy: 55, OU_accuracy: 50};
        const games = data.data || [];
        const container = document.getElementById('oddsContainer');
        container.innerHTML = '';

        if (games.length === 0) {
          container.innerHTML = '<p style="text-align:center;">No games available.</p>';
          return;
        }

        // Group games by date
        const groupedByDay = {};
        games.forEach(g => {
          const day = new Date(g.commence_time).toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
          if (!groupedByDay[day]) groupedByDay[day] = [];
          groupedByDay[day].push(g);
        });

        const sportOrder = ["americanfootball_nfl", "americanfootball_ncaaf"];

        Object.keys(groupedByDay).sort((a,b) => new Date(a) - new Date(b)).forEach(day => {
          const daySection = document.createElement('div');
          daySection.className = 'day-section';
          daySection.innerHTML = `<h2 style="color:#00c6ff;">${day}</h2>`;
          container.appendChild(daySection);

          const bySport = {};
          groupedByDay[day].forEach(g => {
            if (!bySport[g.sport_key]) bySport[g.sport_key] = [];
            bySport[g.sport_key].push(g);
          });

          Object.keys(bySport).sort((a,b)=>{
            const orderA = sportOrder.indexOf(a);
            const orderB = sportOrder.indexOf(b);
            if (orderA !== orderB) return orderB - orderA;
            return a.localeCompare(b);
          }).forEach(sport => {
            const sportTitle = sport.replace('americanfootball_','').toUpperCase();
            const sportHeader = document.createElement('div');
            sportHeader.className = 'sport-header';
            sportHeader.innerText = sportTitle;
            daySection.appendChild(sportHeader);

            const table = document.createElement('table');
            table.innerHTML = `
              <thead>
                <tr>
                  <th>Matchup</th>
                  <th>Straight Up</th>
                  <th>ATS</th>
                  <th>Over/Under</th>
                  <th>Book</th>
                </tr>
              </thead>
              <tbody></tbody>
            `;
            const tbody = table.querySelector('tbody');

            bySport[sport].forEach(g => {
              const spread = Math.abs(g.fav_spread ?? 0);
              const total = g.total ?? 50;

              const suConf = normalize(100 - spread * 5, 40, 95) * (recent.SU_accuracy / 100);
              const atsConf = normalize(100 - spread * 7, 35, 90) * (recent.ATS_accuracy / 100);
              const ouConf = normalize(100 - Math.abs(total - 50) * 1.5, 40, 85) * (recent.OU_accuracy / 100);

              const ouPick = Math.random() > 0.5 ? 'Over' : 'Under';
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${g.matchup}</td>
                <td style="color:${confidenceColor(suConf)}">${g.favorite_team || '-'} (${suConf.toFixed(1)}%)</td>
                <td style="color:${confidenceColor(atsConf)}">${g.favorite_team || '-'} (${g.fav_spread ?? '-'} / ${atsConf.toFixed(1)}%)</td>
                <td style="color:${confidenceColor(ouConf)}">${ouPick} (${g.total ?? '-'} / ${ouConf.toFixed(1)}%)</td>
                <td>${g.book}</td>
              `;
              tbody.appendChild(tr);
            });

            daySection.appendChild(table);
          });
        });
      } catch (err) {
        console.error(err);
        document.getElementById('oddsContainer').innerHTML = '<p style="text-align:center;">Error loading odds data.</p>';
      }
    }

    async function loadPerformance() {
      try {
        const res = await fetch('performance_log.json');
        const logs = await res.json();
        const latest = logs[logs.length - 1];
        const div = document.getElementById('performance');
        if (latest) {
          div.innerHTML = `
            <h2>ðŸ“Š Weekly Accuracy</h2>
            <p>Straight Up (SU): ${latest.SU_accuracy}%</p>
            <p>Against the Spread (ATS): ${latest.ATS_accuracy}%</p>
            <p>Over/Under (O/U): ${latest.OU_accuracy}%</p>
            <p><small>Games Checked: ${latest.games_checked}</small></p>
          `;
        } else {
          div.innerHTML = '<p>No accuracy data logged yet.</p>';
        }
      } catch (err) {
        console.error(err);
        document.getElementById('performance').innerText = 'Error loading performance data.';
      }
    }

    loadData();
    loadPerformance();
  </script>
</body>
</html>

