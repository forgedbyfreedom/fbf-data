<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forged By Freedom — Sports Model</title>

    <style>
        body {
            background: #0d0d0d;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        /* LOCKED HEADER – UNCHANGED */
        .main-header {
            background: #111;
            padding: 25px 10px;
            border-bottom: 2px solid #ff6600;
        }
        .main-header h1 {
            font-size: 34px;
            color: #ff7a00;
            text-shadow: 0 0 12px #ff7a00;
            margin-bottom: 10px;
        }
        .main-header h2 {
            font-size: 20px;
            font-weight: normal;
            color: #ccc;
            margin-top: 0;
        }

        /* FILTER BUTTONS */
        .filter-buttons {
            margin: 20px 0;
        }
        .filter-buttons button {
            margin: 4px;
            padding: 10px 20px;
            background-color: #222;
            color: #fff;
            border: 1px solid #444;
            cursor: pointer;
        }
        .filter-buttons button.active {
            background-color: #ff6600;
            border-color: #ff6600;
        }

        /* GRID — OPTION B (3 Across) */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            padding: 20px;
            width: 95%;
            margin: 0 auto;
        }

        /* GAME CARD */
        .game-card {
            background: #1a1a1a;
            padding: 18px;
            border-radius: 10px;
            border: 2px solid #333;
            text-align: left;
            position: relative;
        }
        .game-card.high-confidence {
            border-color: #ff6600;
            box-shadow: 0 0 20px #ff6600;
        }

        /* Teams */
        .teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .team {
            width: 48%;
            text-align: center;
        }
        .team img {
            width: 70px;
            height: 70px;
        }
        .team-name {
            margin-top: 8px;
            font-size: 16px;
        }

        /* Picks Section */
        .pick-box {
            margin-top: 12px;
            padding: 10px;
            background: #111;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .pick-title {
            font-size: 14px;
            margin-bottom: 4px;
            color: #ff7a00;
        }
        .pick-value {
            font-size: 17px;
            font-weight: bold;
        }
        .confidence {
            margin-top: 4px;
            font-size: 13px;
            color: #ccc;
        }

        /* Odds block */
        .odds {
            margin-top: 12px;
            font-size: 14px;
            color: #aaa;
        }

        /* Weather block */
        .weather {
            margin-top: 12px;
            padding: 10px;
            background: #222;
            border: 1px solid #555;
            border-radius: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <!-- LOCKED HEADER - UNCHANGED -->
    <div class="main-header">
        <h1>FORGED BY FREEDOM • STRENGTH & NUTRITION</h1>
        <h2>LIVE ODDS + PICKS UPDATED EVERY 15 MINUTES • ENTERTAINMENT ONLY</h2>
    </div>

    <!-- FILTERS -->
    <div class="filter-buttons">
        <button onclick="setFilter('all')" class="active">ALL</button>
        <button onclick="setFilter('nfl')">NFL</button>
        <button onclick="setFilter('ncaaf')">NCAAF</button>
        <button onclick="setFilter('nba')">NBA</button>
        <button onclick="setFilter('ncaab')">NCAAB</button>
        <button onclick="setFilter('nhl')">NHL</button>
    </div>

    <div id="gameGrid" class="game-grid"></div>

    <script>
        let globalData = [];
        let currentSportFilter = "all";

        async function loadData() {
            try {
                const res = await fetch("predictions.json?v=" + Date.now());
                const json = await res.json();
                globalData = json.data || json.predictions || [];
                renderGames();
            } catch (e) {
                console.error("Error loading predictions.json", e);
            }
        }

        function setFilter(sport) {
            currentSportFilter = sport;
            document.querySelectorAll(".filter-buttons button").forEach(b => b.classList.remove("active"));
            // inline onclick gives us a global event in browser
            if (window.event && window.event.target) {
                window.event.target.classList.add("active");
            }
            renderGames();
        }

        function cap99(val) {
            if (!Number.isFinite(val)) return null;
            return Math.min(99, Math.max(0, val));
        }

        function formatSpread(num) {
            if (!Number.isFinite(num)) return "N/A";
            if (num === 0) return "PK";
            return (num > 0 ? "+" + num : String(num));
        }

        function renderGames() {
            const container = document.getElementById("gameGrid");
            container.innerHTML = "";

            let filtered = globalData;
            if (currentSportFilter !== "all") {
                filtered = globalData.filter(g => g.sport === currentSportFilter);
            }

            filtered.forEach(game => {
                const odds = game.odds || {};
                const spread = (typeof odds.spread === "number") ? odds.spread : null;
                const total = (typeof odds.total === "number") ? odds.total : null;

                const pred_margin = (typeof game.pred_margin === "number") ? game.pred_margin : null;
                const pred_total  = (typeof game.pred_total  === "number") ? game.pred_total  : null;

                const homeTeamName = game.home_team?.name || "Home";
                const awayTeamName = game.away_team?.name || "Away";

                /* ---------- STRAIGHT UP PICK ---------- */
                let suPick = game.pick_team || "N/A";
                let confSu = null;
                if (pred_margin !== null) {
                    confSu = cap99(Math.abs(pred_margin) * 6.25);
                }

                /* ---------- ATS PICK ---------- */
                let atsDisplay = "N/A";
                let confAts = null;
                if (spread !== null && pred_margin !== null) {
                    // which side covers according to model?
                    let atsTeamName = null;
                    if (pred_margin > spread) {
                        atsTeamName = homeTeamName;
                    } else if (pred_margin < spread) {
                        atsTeamName = awayTeamName;
                    }

                    if (atsTeamName) {
                        // Book line is stored as home spread
                        let teamSpread;
                        if (atsTeamName === homeTeamName) {
                            teamSpread = spread;
                        } else {
                            teamSpread = -spread;
                        }
                        atsDisplay = atsTeamName + " " + formatSpread(teamSpread);
                        confAts = cap99(Math.abs(pred_margin - spread) * 6.25);
                    } else {
                        atsDisplay = "No Edge";
                    }
                }

                /* ---------- TOTAL (O/U) PICK ---------- */
                let totalDisplay = "N/A";
                let confTotal = null;
                if (total !== null && pred_total !== null) {
                    if (pred_total > total) {
                        totalDisplay = "OVER";
                    } else if (pred_total < total) {
                        totalDisplay = "UNDER";
                    } else {
                        totalDisplay = "No Edge";
                    }
                    confTotal = cap99(Math.abs(pred_total - total) * 6.25);
                }

                /* HIGH CONFIDENCE FLAG */
                const maxConf = Math.max(
                    confSu || 0,
                    confAts || 0,
                    confTotal || 0
                );
                const isHigh = (game.high_confidence === true) || maxConf >= 80;

                /* Weather */
                let weatherHTML = "";
                if (game.venue && !game.venue.indoor && game.weather) {
                    const summary = game.weather.summary ?? "";
                    const temp = game.weather.temp ?? game.weather.temperatureF ?? "";
                    const wind = game.weather.wind ?? game.weather.windSpeedMph ?? "";
                    weatherHTML = `
                        <div class="weather">
                            <strong>Weather:</strong> ${summary}<br>
                            Temp: ${temp}°F<br>
                            Wind: ${wind} mph
                        </div>`;
                }

                container.innerHTML += `
                    <div class="game-card ${isHigh ? "high-confidence" : ""}">
                        <div class="teams">
                            <div class="team">
                                <img src="${game.away_team?.logo || ""}" alt="">
                                <div class="team-name">${awayTeamName}</div>
                            </div>
                            <div class="team">
                                <img src="${game.home_team?.logo || ""}" alt="">
                                <div class="team-name">${homeTeamName}</div>
                            </div>
                        </div>

                        <div class="odds">
                            <div><strong>Spread:</strong> ${odds.details || "N/A"}</div>
                            <div><strong>Total:</strong> ${total !== null ? total : "N/A"}</div>
                        </div>

                        <div class="pick-box">
                            <div class="pick-title">STRAIGHT UP</div>
                            <div class="pick-value">${suPick}</div>
                            <div class="confidence">
                                Confidence: ${confSu !== null ? confSu.toFixed(1) + "%" : "N/A"}
                            </div>
                        </div>

                        <div class="pick-box">
                            <div class="pick-title">ATS (Spread)</div>
                            <div class="pick-value">${atsDisplay}</div>
                            <div class="confidence">
                                Confidence: ${confAts !== null ? confAts.toFixed(1) + "%" : "N/A"}
                            </div>
                        </div>

                        <div class="pick-box">
                            <div class="pick-title">TOTAL (O/U)</div>
                            <div class="pick-value">${totalDisplay}</div>
                            <div class="confidence">
                                Confidence: ${confTotal !== null ? confTotal.toFixed(1) + "%" : "N/A"}
                            </div>
                        </div>

                        ${weatherHTML}
                    </div>
                `;
            });
        }

        loadData();
        // 15 minutes = 900000 ms
        setInterval(loadData, 900000);
    </script>

</body>
</html>
