<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forged By Freedom Betting Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        margin: 0;
        padding: 0;
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
    }

    a {
        color: #ff8c00;
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }

    /* Header */
    .header {
        text-align: center;
        padding: 30px 10px 16px 10px;
        border-bottom: 1px solid #222;
        position: relative;
    }

    .glow {
        color: #ff8c00;
        text-shadow: 0 0 12px #ff8c00, 0 0 20px #ff6600, 0 0 30px #ff4500;
        animation: pulse 2.5s infinite ease-in-out;
    }
    @keyframes pulse {
        0%   { text-shadow: 0 0 10px #ff8c00; }
        50%  { text-shadow: 0 0 25px #ff4500; }
        100% { text-shadow: 0 0 10px #ff8c00; }
    }

    /* Picks banner */
    .banner {
        background: linear-gradient(90deg, #111, #000);
        border-bottom: 1px solid #222;
        padding: 12px 10px;
        text-align: center;
        font-size: 16px;
        color: #ff8c00;
        position: sticky;
        top: 0;
        z-index: 999;
    }

    /* Sticky sport tabs */
    .tabs {
        position: sticky;
        top: 44px; /* sits under banner */
        z-index: 998;
        background: #000;
        border-bottom: 1px solid #222;
        display: flex;
        overflow-x: auto;
        gap: 8px;
        padding: 8px 10px;
        scrollbar-width: none;
    }
    .tabs::-webkit-scrollbar { display: none; }

    .tab {
        white-space: nowrap;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 13px;
        background: #111;
        border: 1px solid #222;
        color: #ccc;
        cursor: pointer;
        transition: 0.2s;
        user-select: none;
    }
    .tab:hover {
        border-color: #ff8c00;
        color: #ff8c00;
    }
    .tab.active {
        background: #ff8c00;
        color: #000;
        border-color: #ff8c00;
        font-weight: bold;
    }

    /* Summary boxes */
    .summary-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding: 12px;
        border-bottom: 1px solid #222;
        background: #000;
    }
    .summary-box {
        background: #0b0b0b;
        border: 1px solid #222;
        border-radius: 12px;
        padding: 12px;
        text-align: center;
        box-shadow: 0 0 12px rgba(255,140,0,0.12);
    }
    .summary-title {
        font-size: 12px;
        color: #aaa;
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .summary-value {
        font-size: 20px;
        color: #ff8c00;
        font-weight: bold;
    }

    /* Sport section */
    .sport-section {
        margin: 0;
        border-bottom: 1px solid #111;
    }

    .sport-title {
        font-size: 26px;
        margin: 0;
        text-align: center;
        padding: 18px 10px;
        border-top: 2px solid #222;
        border-bottom: 1px solid #222;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        user-select: none;
        position: sticky;
        top: 86px; /* banner + tabs */
        z-index: 20;
        background: #000;
    }

    .sport-title .chev {
        font-size: 18px;
        color: #666;
        transform: rotate(0deg);
        transition: 0.2s;
    }
    .sport-section.collapsed .sport-title .chev {
        transform: rotate(-90deg);
    }

    /* Color-coded headers */
    .sport-nfl   { color: #00e5ff; }
    .sport-ncaaf { color: #7CFC00; }
    .sport-ncaab { color: #ff8c00; }
    .sport-nba   { color: #ff3b3b; }
    .sport-nhl   { color: #b388ff; }
    .sport-mlb   { color: #ffd54f; }
    .sport-other { color: #ff8c00; }

    .games-wrap {
        padding: 0 6px 10px 6px;
    }

    .game-card {
        border: 1px solid #222;
        background: #050505;
        border-radius: 12px;
        padding: 12px;
        margin: 10px 6px;
        box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }

    .team-line {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 6px;
    }

    .favorite-tag {
        color: #ff8c00;
        font-weight: bold;
        margin-right: 6px;
    }

    .meta-row {
        color: #888;
        margin-top: 6px;
        font-size: 14px;
        line-height: 1.35;
    }

    .tiny {
        color:#666;
        font-size:12px;
        margin-top: 6px;
    }

    .pill {
        display:inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        background: #111;
        border: 1px solid #222;
        font-size: 12px;
        color:#bbb;
        margin-right: 6px;
        margin-top: 4px;
    }

    .pill.hot { border-color:#ff8c00; color:#ff8c00; }
    .pill.good { border-color:#7CFC00; color:#7CFC00; }
    .pill.bad { border-color:#ff3b3b; color:#ff3b3b; }

    .prediction-box {
        margin-top: 8px;
        padding: 8px;
        background: #0b0b0b;
        border: 1px dashed #333;
        border-radius: 8px;
        font-size: 14px;
        color: #ddd;
    }
</style>
</head>

<body>

<div class="banner glow">
    üèà Live Odds + Picks Updated Every 15 Minutes ‚Ä¢ For Entertainment Only
</div>

<div class="header">
    <div class="glow" style="font-size:20px;">
        Provided to you by  
        <a href="https://forgedbyfreedom.org" target="_blank">ForgedByFreedom.org</a>
    </div>

    <div class="glow" style="font-size:34px; margin-top:8px;">
        FORGED BY FREEDOM STRENGTH AND NUTRITION
    </div>

    <div class="glow" style="font-size:20px; margin-top:5px;">
        STRENGTH ‚Äì DISCIPLINE ‚Äì FREEDOM
    </div>

    <div style="margin-top:10px; font-size:16px; color:#ccc;">
        Visit us for all your fitness, nutrition and supplement program needs
        <br><br>
        <span style="font-size:14px; color:#666;">For entertainment purposes only</span>
    </div>
</div>

<div class="summary-row" id="summary-row">
    <div class="summary-box">
        <div class="summary-title">Total Games</div>
        <div class="summary-value" id="sum-games">0</div>
    </div>
    <div class="summary-box">
        <div class="summary-title">Favorites Tagged</div>
        <div class="summary-value" id="sum-favs">0</div>
    </div>
    <div class="summary-box">
        <div class="summary-title">Picks Available</div>
        <div class="summary-value" id="sum-picks">0</div>
    </div>
</div>

<div class="tabs" id="tabs"></div>
<div id="sports-container"></div>

<script>
async function loadJson(url) {
    const r = await fetch(url, { cache: "no-store" });
    if (!r.ok) return null;
    return await r.json();
}

function safeSportKey(g){
    return (g.sport_key || g.sport || "other").toLowerCase();
}

function safeSportLabel(key) {
    if (!key) return "SPORT";
    return key.replace(/_/g, " ").toUpperCase();
}

function parseTime(g){
    const raw = g.commence_time || g.date_utc || g.date || g.date_local;
    if (!raw) return null;
    const d = new Date(raw);
    if (isNaN(d.getTime())) return null;
    return d;
}

function fmtLocal(d){
    if (!d) return "Invalid Date";
    return d.toLocaleString();
}

function favText(g){
    if (g.favorite) return g.favorite;
    if (g.fav_team && g.spread != null) return `${g.fav_team} ${g.spread > 0 ? "-" : ""}${Math.abs(g.spread)}`;
    if (g.odds && g.odds.details) return g.odds.details;
    return "";
}

function totalText(g){
    if (g.total != null) return g.total;
    if (g.odds && g.odds.total != null) return g.odds.total;
    return "N/A";
}

function spreadText(g){
    if (g.spread != null) return g.spread;
    if (g.odds && g.odds.spread != null) return g.odds.spread;
    return "N/A";
}

function hasPick(g){
    const p = g.prediction || {};
    return (
        p.pick || p.edge || p.modelPick || p.recommendedBet ||
        p.homeWinPct != null || p.awayWinPct != null ||
        p.predictedSpread != null || p.predictedTotal != null
    );
}

function renderPrediction(g){
    const p = g.prediction || {};
    if (!hasPick(g)) {
        return `<div class="prediction-box">Prediction: <b>No prediction yet</b></div>`;
    }

    const lines = [];
    if (p.pick) lines.push(`Pick: <b>${p.pick}</b>`);
    if (p.modelPick) lines.push(`Model Pick: <b>${p.modelPick}</b>`);
    if (p.edge != null) lines.push(`Edge: <b>${p.edge}</b>`);
    if (p.predictedSpread != null) lines.push(`Pred Spread: <b>${p.predictedSpread}</b>`);
    if (p.predictedTotal != null) lines.push(`Pred Total: <b>${p.predictedTotal}</b>`);
    if (p.homeWinPct != null || p.awayWinPct != null) {
        lines.push(`Win %: Home <b>${p.homeWinPct ?? "?"}%</b> / Away <b>${p.awayWinPct ?? "?"}%</b>`);
    }

    return `<div class="prediction-box">${lines.join("<br>")}</div>`;
}

function renderSports(data) {
    const container = document.getElementById("sports-container");
    const tabs = document.getElementById("tabs");
    container.innerHTML = "";
    tabs.innerHTML = "";

    // group by sport
    const bySport = {};
    data.forEach(g => {
        const k = safeSportKey(g);
        if (!bySport[k]) bySport[k] = [];
        bySport[k].push(g);
    });

    // sort sports by number of games, desc
    const sportKeys = Object.keys(bySport)
        .sort((a,b)=> bySport[b].length - bySport[a].length);

    // build tabs
    sportKeys.forEach((k, idx)=>{
        const tab = document.createElement("div");
        tab.className = "tab" + (idx===0 ? " active":"");
        tab.textContent = safeSportLabel(k);
        tab.onclick = () => {
            document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
            tab.classList.add("active");
            const el = document.getElementById("sport-"+k);
            if (el) el.scrollIntoView({ behavior:"smooth", block:"start" });
        };
        tabs.appendChild(tab);
    });

    sportKeys.forEach(k => {
        const section = document.createElement("div");
        section.className = "sport-section";
        section.id = "sport-"+k;

        const title = document.createElement("div");
        title.className = `sport-title sport-${k}`;
        title.innerHTML = `<span class="chev">‚ñ∂</span> ${safeSportLabel(k)} (${bySport[k].length})`;
        title.onclick = () => section.classList.toggle("collapsed");

        section.appendChild(title);

        const wrap = document.createElement("div");
        wrap.className = "games-wrap";

        // auto-sort by time
        bySport[k].sort((a,b)=>{
            const ta = parseTime(a);
            const tb = parseTime(b);
            if (!ta && !tb) return 0;
            if (!ta) return 1;
            if (!tb) return -1;
            return ta - tb;
        });

        bySport[k].forEach(g => {
            const card = document.createElement("div");
            card.className = "game-card";

            const awayName = g.away_team?.name || g.away_team || g.awayTeam || g.away || "AWAY";
            const homeName = g.home_team?.name || g.home_team || g.homeTeam || g.home || "HOME";

            const fav = favText(g);
            const matchup = `${awayName} @ ${homeName}`;

            const time = parseTime(g);
            const oddsProvider = g.odds?.provider || g.provider || "ESPN";

            const weatherRisk = g.weatherRisk?.overallRisk != null
                ? `Weather Risk: ${g.weatherRisk.overallRisk}`
                : (g.venue?.indoor || g.weather?.indoor)
                    ? "Weather Risk: Indoor / N/A"
                    : (g.weather?.error ? `Weather Risk: ${g.weather.error}` : "Weather Risk: N/A");

            const tags = (g.weatherRisk?.tags || g.flags || []).slice(0,6);

            card.innerHTML = `
                <div class="team-line">
                    ${fav ? `<span class="favorite-tag">${fav}</span>` : ""}
                    ${matchup}
                </div>

                <div class="meta-row">
                    Odds: ${g.odds?.details || "N/A"} <span class="tiny">(${oddsProvider})</span><br>
                    Spread: ${spreadText(g)} | Total: ${totalText(g)}<br>
                    ${weatherRisk}<br>
                    Time: ${fmtLocal(time)}
                </div>

                ${tags.length ? `<div class="meta-row">
                    ${tags.map(t=>`<span class="pill hot">${t}</span>`).join("")}
                </div>` : ""}

                ${renderPrediction(g)}
            `;

            wrap.appendChild(card);
        });

        section.appendChild(wrap);
        container.appendChild(section);
    });
}

function updateSummary(data){
    const totalGames = data.length;
    const favs = data.filter(g => g.favorite || g.fav_team || (g.odds && g.odds.details)).length;
    const picks = data.filter(hasPick).length;

    document.getElementById("sum-games").textContent = totalGames;
    document.getElementById("sum-favs").textContent = favs;
    document.getElementById("sum-picks").textContent = picks;
}

async function boot() {
    const combined = await loadJson("https://data.forgedbyfreedom.org/combined.json");
    if (!combined || !combined.data || !Array.isArray(combined.data)) {
        document.getElementById("sports-container").innerHTML =
            "<div style='padding:20px; text-align:center;'>No games available.</div>";
        return;
    }

    const games = combined.data;
    updateSummary(games);
    renderSports(games);
}

boot();
</script>

</body>
</html>
